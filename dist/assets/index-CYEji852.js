import{v as g,a as b,G as A,j as y,V as s}from"./uwal-BNRo3Xsn.js";import{v as F,a as c}from"./wgpu-matrix.module-3qzuEYdi.js";var V="struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_external;@group(0)@binding(2)var<uniform>projection: mat4x4f;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {var output: VertexOutput;var position=GetQuadCoord(index);position=(position+1)*0.5;output.position=projection*vec4f(position,0,1);output.textureCoord=position;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSampleBaseClampToEdge(Texture,Sampler,textureCoord);}";/**
 * @module Using Camera
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This lesson is reproduced from WebGPU Using Video Efficiently
 * {@link https://webgpufundamentals.org/webgpu/lessons/webgpu-textures-external-video.html#a-web-camera}&nbsp;
 * and developed by using a version listed below. Please note that this code
 * may be simplified in future thanks to more recent library APIs.
 * @version 0.0.12
 * @license MIT
 */(async function(u){let t;try{t=new(await g.RenderPipeline(u,"Using Camera"))}catch(e){alert(e)}const o=new b,i=document.createElement("video"),l=[],m=F.set(1.2,.5);o.Position=[0,0,2],o.LookAt([0,0,0]);const C=o.UpdateViewProjection(!1);t.CreatePipeline(t.CreateShaderModule([A.Quad,V]));const d=t.CreateColorAttachment();d.clearValue=new y(5000268).rgba,t.CreatePassDescriptor(d);const p=new(await g.LegacyTexture());await E(i),await R(i);for(let e=0;e<4;e++)l.push({...t.CreateUniformBuffer("projection"),sampler:p.CreateSampler({magFilter:e&1?s.FILTER.LINEAR:s.FILTER.NEAREST,minFilter:e&2?s.FILTER.LINEAR:s.FILTER.NEAREST,addressModeUV:s.ADDRESS.REPEAT})});async function E(e){try{e.srcObject=await navigator.mediaDevices.getUserMedia({video:!0}),e.play()}catch(a){const n=a.message&&`: ${a.message}`||"";console.error(`Could not access the camera${n}.`)}}function R(e){return new Promise((a,n)=>{if(e.addEventListener("error",n),"requestVideoFrameCallback"in e)e.requestVideoFrameCallback(a);else{const r=()=>e.currentTime?a():requestAnimationFrame(r);r()}})}function f(){requestAnimationFrame(f);const e=p.ImportExternalTexture(i);l.forEach(({sampler:a,buffer:n,projection:r},x)=>{const w=x%2-.5,v=+(x<2)*2-1,T=[w*m[0],v*m[1],-.5];c.translate(C,T,r),c.rotateX(r,Math.PI*.25*Math.sign(v),r),c.scale(r,[1,-1,1],r),c.translate(r,[-.5,-.5,0],r),t.WriteBuffer(n,r),t.SetBindGroups(t.CreateBindGroup(t.CreateBindGroupEntries([a,e,{buffer:n}]))),t.Render(6,!1)}),t.Submit()}const S=new ResizeObserver(e=>{for(const a of e){const{inlineSize:n,blockSize:r}=a.contentBoxSize[0];t.SetCanvasSize(n,r)}o.AspectRatio=t.AspectRatio,o.UpdateViewProjection(!1),requestAnimationFrame(f)});u.addEventListener("click",()=>i[i.paused?"play":"pause"]()),S.observe(document.body)})(document.getElementById("lesson"));
